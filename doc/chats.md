# Chat History

The MAI repl needs a way to save the repl history in a single file and the chat history for each session in separate files. Implement the following changes in src/repl:

- Add -n command flag to set the "history" configuration variable (conf.go)
- The -n flag should already be used to not load the ~/.mairc file
  - Confirm this behaviour is working as expected and well documented
- Chat history only affects repl mode (not stdin mode)
- The implementation of the mai repl is inside the `src/repl` directory, there's no need to dig into other places
- Create the directory "~/.mai/chat" on startup time if it doesnt exist
- Use the ~/.mai/history.json to store all the lines entered in the repl
- Input text can contain any character, even newlines for multiline text
- Use JSON to store the array of strings in the ~/.mai/history.json
- When leaving the chat, load the history from home, append the new ones from the current session and save it
- When leaving, if conf.history is set we may "/chat save" the current conversation into a file under ~/.mai/sessions
- Add the `/sessions` command in the repl, to list all the sessions
  - When listing the sessions show the filename, file size and topic text
  - The topic text can be generated with the " #topic" command this is using the topic prompt to get a short text from it
- Add the `/session <session-name>` command to switch to a different session (load the chat conversation)
- Chat sessions should be named with a timestamp like (YYYYMMDDhhmmss)
- We may want to add a title to each conversation, which can be autogenerated with ` #topic`

## Development Plan

To accomplish the implementation of chat history and chat sessions for your MAI REPL, we can break down the development process into several stages or commits. This will allow for better organization and incremental progress. Here's an outline to help guide the development:

### Stage 1: Initial Setup and Basic Functionality

1. **Command Flag Implementation**
   - **Task 1.1:** Add a `-n` command-line flag to the configuration (`conf.go`) to control the historical behavior.
   - **Task 1.2:** Ensure that the `-n` flag prevents loading of the `~/.mairc` file, and verify that this behavior is correctly documented within the project's documentation.

2. **Directory and File Management**
   - **Task 1.3:** Implement logic to create the `~/.mai/chat` directory at startup if it does not exist.
   - **Task 1.4:** Establish the `~/.mai/history.json` file that stores the command history as a JSON array of strings.

### Stage 2: Input Handling and REPL Integration

3. **Chat History Storage**
   - **Task 2.1:** Integrate the functionality within the REPL to capture and store entered text, including multiline input, into the `~/.mai/history.json`.

4. **Session Management Implementation**
   - **Task 2.2:** Develop the logic to save current session history into separate files under `~/.mai/sessions` upon exiting. Ensure the filenames use a timestamp format (`YYYYMMDDhhmmss`).
   - **Task 2.3:** Implement logic to append current session data to `~/.mai/history.json` on exit.

### Stage 3: Session Listing and Switching

5. **Session Listing Feature**
   - **Task 3.1:** Create a command within the REPL to list all session files, displaying filename, file size, and topic text.
   - **Task 3.2:** Implement a way to generate or enrich sessions with a topic using a `#topic` command, providing a short descriptive text.

6. **Session Switching Functionality**
   - **Task 3.3:** Add a command to the REPL that allows switching to different chat sessions (loading the conversation).

### Stage 4: Enhancements and Documentation

7. **Conversation Titling and Documentation**
   - **Task 4.1:** Develop a feature to automatically add titles to conversations, possibly using a keyword or hashtag identified by the user.
   - **Task 4.2:** Ensure comprehensive documentation outlining the use of these new features and any updates to existing commands.

### Stage 5: Testing and Finalization

8. **Testing and Validation**
   - **Task 5.1:** Conduct thorough testing of all new functionalities, including edge cases such as unusual characters in input and non-standard session switching commands.

9. **Final Review and Optimization**
   - **Task 5.2:** Review the codebase for potential optimizations and ensure compliance with best practices.

By following this structured approach, you ensure modular development, allowing each part to be independently developed, tested, and refined. Commits can align closely with each task or subtask to maintain a clear version history.
