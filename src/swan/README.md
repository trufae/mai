# SWAN: Swarm Agent Network - A2A Infrastructure for MAI

## Overview

SWAN (Swarm Agent Network) is a new module in `src/swan/` that implements an Agent-to-Agent (A2A) infrastructure for coordinating multiple MAI instances as autonomous daemons. It enables organic growth through self-learning, dynamic decision-making, and integration with existing MAI features like MCP, VectorDB, and OpenAI endpoints. SWAN reuses code from `src/mcps/lib/`, `src/repl/llm/`, `src/vdb/`, and `src/repl/serve.go` to minimize duplication while providing a flexible, user-configurable system.

## Core Components

- **Configuration System:** A generic YAML config file (`swan.yaml`) allows users to define initial agent setups, including models (e.g., Claude, Gemini), MCP servers, prompts, and work directories for temporal data and annotations.
- **Agent Daemons:** Multiple MAI processes running as background daemons, each with unique configs, communicating via MCP or OpenAI endpoints.
- **Orchestrator Server:** A central Go server that routes tasks to agents, uses VectorDB for context and learning, and self-optimizes by analyzing results and updating configs.
- **Learning Engine:** Stores annotations, performance metrics, and autogenerated overrides in VectorDB, enabling organic evolution (e.g., spawning better agents).
- **Process Management:** Handles daemon lifecycle (start/stop/restart) without Docker, using Go's `os/exec` for spawning MAI instances.

## Key Features

- **User-Defined Config:** Initial setup via `swan.yaml` (e.g., agent types, models, MCP endpoints).
- **Self-Learning:** Annotations from decisions/results feed into VectorDB; orchestrator summarizes quality and adjusts configs dynamically.
- **Integration:** Leverages existing MAI tools (MCP for inter-agent comms, OpenAI endpoints for compatibility, VectorDB for data).
- **Organic Growth:** Agents report capabilities; system learns to select best configs per task, restarting agents as needed.
- **No External Dependencies:** Runs natively, reusing MAI's codebase for providers, MCP, and VDB.

## Architecture

- **Config Loader:** Parses `swan.yaml` and loads defaults.
- **Daemon Manager:** Spawns/stops MAI agents as processes.
- **Task Router:** Matches tasks to agents based on history and VDB queries.
- **Feedback Loop:** Post-task analysis for improvements.
- **API Layer:** Exposes OpenAI-like endpoints for external access.

## Development Plan

1. **Setup Module Structure:**
   - Create `src/swan/` directory with subdirs: `cmd/` (main binary), `config/` (YAML parsing), `daemon/` (process management), `orchestrator/` (server logic), `learning/` (VDB integration).
   - Reuse `src/mcps/lib/mcp.go` for MCP client/server.
   - Reuse `src/repl/llm/` for LLM clients.
   - Reuse `src/vdb/` for data storage.

2. **Implement Configuration:**
   - Define `swan.yaml` schema: work_dir, agents (list with model, mcp, prompts), orchestrator settings.
   - Add config loader in `config/config.go` using YAML parsing.

3. **Build Daemon Manager:**
   - In `daemon/manager.go`, use `os/exec` to spawn MAI instances with custom configs.
   - Implement health checks and restarts.

4. **Develop Orchestrator Server:**
   - In `orchestrator/server.go`, create HTTP server serving OpenAI endpoints (reuse `src/repl/serve.go` patterns).
   - Add task routing logic using VDB queries for agent selection.

5. **Integrate Learning Engine:**
   - In `learning/engine.go`, use `src/vdb/` to store annotations and metrics.
   - Implement summarization and config override generation.

6. **Add API Endpoints:**
   - `/v1/chat/completions` for task ingestion.
   - `/api/agents` for listing/managing agents.
   - `/api/learn` for manual annotations.

7. **Testing and Validation:**
   - Unit tests for config parsing and daemon spawning.
   - Integration tests with mock agents and VDB.
   - Performance tests for multi-agent scenarios.

8. **Documentation and Examples:**
   - Update `README.md` with usage examples.
   - Provide sample `swan.yaml` configs.

## Required Changes Plan

Since all required features are supported by existing MAI code (MCP, LLM providers, VDB, OpenAI serving), no major changes are needed. However, if future enhancements require it, create `src/swan/CHANGES.md` with:
- Extend `src/repl/llm/` for new providers if needed.
- Enhance `src/vdb/` for advanced querying.
- Add process isolation features if scaling demands it.

This plan ensures SWAN is a lightweight, reusable extension of MAI, focusing on coordination and learning without reinventing core functionality.

## Usage

1. **Build SWAN:**
   ```bash
   cd src/swan/cmd
   go build -o swan main.go
   ```

2. **Configure:**
   Edit `swan.yaml` with your desired agents, models, and MCP servers.

3. **Run:**
   ```bash
   ./swan swan.yaml
   ```

4. **API Usage:**
   - OpenAI endpoint: `POST http://localhost:8080/v1/chat/completions`
   - List agents: `GET http://localhost:8080/api/agents`
   - Health check: `GET http://localhost:8080/health`

## Current Status

- âœ… Basic module structure
- âœ… YAML config loader
- âœ… Daemon manager with process spawning
- âœ… Agent tracking in work/tmp/swan_agents.json
- âœ… Orchestrator server with OpenAI endpoints
- ðŸ”„ VDB integration (planned)
- ðŸ”„ Dynamic decision-making (planned)